machine:
    timezone: Asia/Tokyo
    services:
        - docker

compile:
    override:
        - docker build -t u6kapps/blog-dev -f Dockerfile-dev .
        - docker run --rm -v $(pwd):/var/my-blog u6kapps/blog-dev
        - docker build -t u6kapps/blog .

test:
    override:
        - /bin/true

deployment:
    release:
        branch: master
        commands:
            - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
            - docker push u6kapps/blog
            - curl -v -X POST -u $JENKINS_AUTH https://jenkins.u6k.me/job/update-blog/build -d token=$JENKINS_TOKEN
